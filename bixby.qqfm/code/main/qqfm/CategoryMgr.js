var Category = require("./schema/Category");
var categoryListObj = {
    "categoryList": [{
            "category_id": "39092",
            "category_name": "有声小说",
            "level": 1,
            "categoryList": [{
                    "category_id": "41102",
                    "category_name": "付费精品",
                    "level": 2
                },
                {
                    "category_id": "41092",
                    "category_name": "悬疑推理",
                    "level": 2
                },
                {
                    "category_id": "39096",
                    "category_name": "恐怖灵异",
                    "level": 2
                },
                {
                    "category_id": "38954",
                    "category_name": "玄幻奇幻",
                    "level": 2
                },
                {
                    "category_id": "38949",
                    "category_name": "现代言情",
                    "level": 2
                },
                {
                    "category_id": "38951",
                    "category_name": "古代言情",
                    "level": 2
                },
                {
                    "category_id": "105",
                    "category_name": "鬼故事",
                    "level": 2
                },
                {
                    "category_id": "104",
                    "category_name": "影视原著",
                    "level": 2
                },
                {
                    "category_id": "40042",
                    "category_name": "游戏竞技",
                    "level": 2
                },
                {
                    "category_id": "38953",
                    "category_name": "都市生活",
                    "level": 2
                },
                {
                    "category_id": "38958",
                    "category_name": "武侠传奇",
                    "level": 2
                },
                {
                    "category_id": "38957",
                    "category_name": "官场商战",
                    "level": 2
                },
                {
                    "category_id": "38960",
                    "category_name": "历史军事",
                    "level": 2
                },
                {
                    "category_id": "38959",
                    "category_name": "青春校园",
                    "level": 2
                },
                {
                    "category_id": "40041",
                    "category_name": "耽美同人",
                    "level": 2
                },
                {
                    "category_id": "39103",
                    "category_name": "广播剧",
                    "level": 2
                },
                {
                    "category_id": "40040",
                    "category_name": "财经管理",
                    "level": 2
                },
                {
                    "category_id": "38956",
                    "category_name": "文学名著",
                    "level": 2
                },
                {
                    "category_id": "41093",
                    "category_name": "杂志专栏",
                    "level": 2
                }
            ],
        },
        {
            "category_id": "39104",
            "category_name": "情感生活",
            "level": 1,
            "categoryList": [{
                    "category_id": "39105",
                    "category_name": "情感治愈",
                    "level": 2
                },
                {
                    "category_id": "109",
                    "category_name": "晚安心语",
                    "level": 2
                },
                {
                    "category_id": "39106",
                    "category_name": "美文故事",
                    "level": 2
                },
                {
                    "category_id": "38983",
                    "category_name": "恋爱宝典",
                    "level": 2
                },
                {
                    "category_id": "107",
                    "category_name": "两性夜话",
                    "level": 2
                },
                {
                    "category_id": "108",
                    "category_name": "旅行人文",
                    "level": 2
                }
            ],
        },
        {
            "category_id": "4",
            "category_name": "相声评书",
            "level": 1,
            "categoryList": [{
                    "category_id": "38963",
                    "category_name": "郭德纲",
                    "level": 2
                },
                {
                    "category_id": "38965",
                    "category_name": "单田芳",
                    "level": 2
                },
                {
                    "category_id": "38969",
                    "category_name": "评书大全",
                    "level": 2
                },
                {
                    "category_id": "39109",
                    "category_name": "相声新星",
                    "level": 2
                },
                {
                    "category_id": "38971",
                    "category_name": "相声名家",
                    "level": 2
                },
                {
                    "category_id": "38970",
                    "category_name": "小品大全",
                    "level": 2
                },
                {
                    "category_id": "111",
                    "category_name": "粤语评书",
                    "level": 2
                },
                {
                    "category_id": "40048",
                    "category_name": "刘兰芳",
                    "level": 2
                },
                {
                    "category_id": "40049",
                    "category_name": "王玥波",
                    "level": 2
                },
                {
                    "category_id": "38966",
                    "category_name": "袁阔成",
                    "level": 2
                },
                {
                    "category_id": "38972",
                    "category_name": "田连元",
                    "level": 2
                },
                {
                    "category_id": "39133",
                    "category_name": "戏曲名剧",
                    "level": 2
                }
            ],
        },
        {
            "category_id": "39087",
            "category_name": "搞笑段子",
            "level": 1,
            "categoryList": [{
                    "category_id": "38976",
                    "category_name": "热点趣闻",
                    "level": 2
                },
                {
                    "category_id": "38979",
                    "category_name": "糗事百科",
                    "level": 2
                },
                {
                    "category_id": "106",
                    "category_name": "娱乐段子",
                    "level": 2
                },
                {
                    "category_id": "40015",
                    "category_name": "聊江湖",
                    "level": 2
                },
                {
                    "category_id": "38978",
                    "category_name": "冷笑话",
                    "level": 2
                },
                {
                    "category_id": "38977",
                    "category_name": "方言秀",
                    "level": 2
                }
            ],
        },
        {
            "category_id": "1",
            "category_name": "综艺娱乐",
            "level": 1,
            "categoryList": [{
                    "category_id": "38985",
                    "category_name": "影视精选",
                    "level": 2
                },
                {
                    "category_id": "38974",
                    "category_name": "热门综艺",
                    "level": 2
                },
                {
                    "category_id": "38982",
                    "category_name": "八卦娱乐",
                    "level": 2
                },
                {
                    "category_id": "113",
                    "category_name": "星座风水",
                    "level": 2
                },
                {
                    "category_id": "38980",
                    "category_name": "明星专区",
                    "level": 2
                },
                {
                    "category_id": "116",
                    "category_name": "游戏动漫",
                    "level": 2
                },
                {
                    "category_id": "40043",
                    "category_name": "文娱杂谈",
                    "level": 2
                },
                {
                    "category_id": "40045",
                    "category_name": "时尚生活",
                    "level": 2
                },
                {
                    "category_id": "40044",
                    "category_name": "影视原声",
                    "level": 2
                }
            ],
        },
        {
            "category_id": "39120",
            "category_name": "儿童专区",
            "level": 1,
            "categoryList": [{
                    "category_id": "40005",
                    "category_name": "睡前故事",
                    "level": 2
                },
                {
                    "category_id": "40004",
                    "category_name": "卡通动画",
                    "level": 2
                },
                {
                    "category_id": "40001",
                    "category_name": "儿歌音乐",
                    "level": 2
                },
                {
                    "category_id": "40002",
                    "category_name": "童话寓言",
                    "level": 2
                },
                {
                    "category_id": "40009",
                    "category_name": "儿童文学",
                    "level": 2
                },
                {
                    "category_id": "40070",
                    "category_name": "诗词国学",
                    "level": 2
                },
                {
                    "category_id": "40003",
                    "category_name": "母婴育儿",
                    "level": 2
                },
                {
                    "category_id": "40007",
                    "category_name": "儿童英语",
                    "level": 2
                },
                {
                    "category_id": "40008",
                    "category_name": "益智科普",
                    "level": 2
                },
                {
                    "category_id": "40076",
                    "category_name": "教材教辅",
                    "level": 2
                }
            ],
        },
        {
            "category_id": "39126",
            "category_name": "知识干货",
            "level": 1,
            "categoryList": [{
                    "category_id": "40014",
                    "category_name": "科普充电",
                    "level": 2
                },
                {
                    "category_id": "40072",
                    "category_name": "名人专栏",
                    "level": 2
                },
                {
                    "category_id": "40073",
                    "category_name": "情商心理",
                    "level": 2
                },
                {
                    "category_id": "39127",
                    "category_name": "语言学习",
                    "level": 2
                },
                {
                    "category_id": "114",
                    "category_name": "考试教材",
                    "level": 2
                },
                {
                    "category_id": "40060",
                    "category_name": "职场提升",
                    "level": 2
                },
                {
                    "category_id": "40071",
                    "category_name": "互联网",
                    "level": 2
                },
                {
                    "category_id": "39012",
                    "category_name": "公开课演讲",
                    "level": 2
                },
                {
                    "category_id": "39131",
                    "category_name": "健康养生",
                    "level": 2
                },
                {
                    "category_id": "39129",
                    "category_name": "创业投资",
                    "level": 2
                },
                {
                    "category_id": "39135",
                    "category_name": "生活百科",
                    "level": 2
                }
            ],
        },
        {
            "category_id": "39110",
            "category_name": "音乐电台",
            "level": 1,
            "categoryList": [{
                    "category_id": "39116",
                    "category_name": "经典",
                    "level": 2
                },
                {
                    "category_id": "117",
                    "category_name": "歌手",
                    "level": 2
                },
                {
                    "category_id": "118",
                    "category_name": "乐评",
                    "level": 2
                },
                {
                    "category_id": "40028",
                    "category_name": "动漫",
                    "level": 2
                },
                {
                    "category_id": "40030",
                    "category_name": "电子",
                    "level": 2
                },
                {
                    "category_id": "38936",
                    "category_name": "流行",
                    "level": 2
                },
                {
                    "category_id": "38943",
                    "category_name": "民谣",
                    "level": 2
                },
                {
                    "category_id": "100",
                    "category_name": "3D",
                    "level": 2
                },
                {
                    "category_id": "40029",
                    "category_name": "喊麦",
                    "level": 2
                },
                {
                    "category_id": "40083",
                    "category_name": "催眠",
                    "level": 2
                },
                {
                    "category_id": "102",
                    "category_name": "心情",
                    "level": 2
                },
                {
                    "category_id": "40077",
                    "category_name": "跑步",
                    "level": 2
                },
                {
                    "category_id": "38937",
                    "category_name": "欧美",
                    "level": 2
                },
                {
                    "category_id": "38938",
                    "category_name": "翻唱",
                    "level": 2
                },
                {
                    "category_id": "40078",
                    "category_name": "日韩",
                    "level": 2
                },
                {
                    "category_id": "103",
                    "category_name": "纯音",
                    "level": 2
                },
                {
                    "category_id": "41101",
                    "category_name": "歌单",
                    "level": 2
                },
                {
                    "category_id": "101",
                    "category_name": "榜单",
                    "level": 2
                },
                {
                    "category_id": "40038",
                    "category_name": "粤语",
                    "level": 2
                },
                {
                    "category_id": "38942",
                    "category_name": "影视",
                    "level": 2
                },
                {
                    "category_id": "40079",
                    "category_name": "摇滚",
                    "level": 2
                },
                {
                    "category_id": "40082",
                    "category_name": "原创",
                    "level": 2
                },
                {
                    "category_id": "40080",
                    "category_name": "古风",
                    "level": 2
                },
                {
                    "category_id": "40081",
                    "category_name": "宗教",
                    "level": 2
                },
                {
                    "category_id": "40039",
                    "category_name": "古典",
                    "level": 2
                },
                {
                    "category_id": "40036",
                    "category_name": "世界",
                    "level": 2
                },
                {
                    "category_id": "40037",
                    "category_name": "儿童",
                    "level": 2
                }
            ],
        },
        {
            "category_id": "18",
            "category_name": "历史人文",
            "level": 1,
            "categoryList": [{
                    "category_id": "40055",
                    "category_name": "野史趣闻",
                    "level": 2
                },
                {
                    "category_id": "40075",
                    "category_name": "佛学修身",
                    "level": 2
                },
                {
                    "category_id": "39132",
                    "category_name": "传奇档案",
                    "level": 2
                },
                {
                    "category_id": "39134",
                    "category_name": "文化讲坛",
                    "level": 2
                },
                {
                    "category_id": "40054",
                    "category_name": "人物传记",
                    "level": 2
                },
                {
                    "category_id": "40050",
                    "category_name": "中国历史",
                    "level": 2
                },
                {
                    "category_id": "40062",
                    "category_name": "世界历史",
                    "level": 2
                },
                {
                    "category_id": "40052",
                    "category_name": "军事战争",
                    "level": 2
                },
                {
                    "category_id": "40074",
                    "category_name": "人文艺术",
                    "level": 2
                }
            ],
        },
        {
            "category_id": "5",
            "category_name": "新闻资讯",
            "level": 1,
            "categoryList": [{
                    "category_id": "38924",
                    "category_name": "头条新闻",
                    "level": 2
                },
                {
                    "category_id": "38925",
                    "category_name": "深度观点",
                    "level": 2
                },
                {
                    "category_id": "39078",
                    "category_name": "社会百态",
                    "level": 2
                },
                {
                    "category_id": "39049",
                    "category_name": "商业财经",
                    "level": 2
                },
                {
                    "category_id": "38927",
                    "category_name": "IT科技",
                    "level": 2
                },
                {
                    "category_id": "38931",
                    "category_name": "军事要闻",
                    "level": 2
                },
                {
                    "category_id": "110",
                    "category_name": "自媒体",
                    "level": 2
                },
                {
                    "category_id": "38929",
                    "category_name": "汽车",
                    "level": 2
                },
                {
                    "category_id": "38930",
                    "category_name": "体育",
                    "level": 2
                }
            ],
        },
        {
            "category_id": "39137",
            "category_name": "广播电台",
            "level": 1
        }
    ],
    "is_lost": 0,
    "ret": 0
};

/**
 * 分类管理器，用来管理大小分类,使用时请调用
 * CategoryMgr.getInstance()方法来做为单例使用。
 */
function CategoryMgr() {
    // 所有分类的对象数组, 成员都是Category类型
    this.categoryList = [];
}

/**
 * 添加分类对象，
 * @param {Category} category 分类对象
 */
CategoryMgr.prototype.addCategory = function(category) {
    this.categoryList.push(category);
};

/**
 * 根据分类id获取所在的分类对象
 * @param {string} id 分类id
 * @returns {Category} 分类对象, 如果不存在就返回null
 */
CategoryMgr.prototype.getCategoryById = function(id) {
    if (this.categoryList.length == 0) {
        return null;
    }

    for (var index = 0; index < this.categoryList.length; index++) {
        var category = this.categoryList[index];
        if (category.getId() == id) {
            return category;
        }

        category = category.getSubCategoryById(id);
        if (category != null) {
            return category;
        }
    }

    return null;
};

/**
 * 根据分类名字获取所在的分类对象
 * @param {string} name 分类名字
 * @returns {Category} 分类对象, 如果不存在就返回null
 */
CategoryMgr.prototype.getCategoryByName = function(name) {
    if (this.categoryList.length == 0) {
        return null;
    }

    for (var index = 0; index < this.categoryList.length; index++) {
        var category = this.categoryList[index];
        if (category.getName() === name) {
            return category;
        }

        category = category.getSubCategoryByName(name);
        if (category != null) {
            return category;
        }
    }

    return null;
};

/**
 * 静态方法，返回CategoryMgr实例对象，可以使用这个对象来管理
 * 分类
 * @returns {CategoryMgr} 分类管理器对象
 */
CategoryMgr.getInstance = function() {
    if (CategoryMgr.instance) {
        return CategoryMgr.instance;
    }

    var instance = new CategoryMgr();
    // 添加分类
    var index = 0;
    for (index = 0; index < categoryListObj.categoryList.length; index++) {
        var categoryItem = categoryListObj.categoryList[index];
        var category = new Category(categoryItem.category_id, categoryItem.category_name,
            categoryItem.level, "0");
        if (categoryItem.categoryList && categoryItem.categoryList.length != 0) {
            for (var j = 0; j < categoryItem.categoryList.length; j++) {
                var subCategoryItem = categoryItem.categoryList[j];
                var subCategory = new Category(subCategoryItem.category_id, subCategoryItem.category_name,
                    subCategoryItem.level, category.getId());
                category.addSubCategory(subCategory);
            }
        }
        instance.addCategory(category);
    }

    CategoryMgr.instance = instance;
    return CategoryMgr.instance;
};

function test() {
    var categoryMgr = CategoryMgr.getInstance();
    var category = categoryMgr.getCategoryById("39092");
    if (!category) {
        console.log("获取 39092 对象失败");
    } else {
        console.log("成功获取 39092 对象");
        console.log(category);
    }

    category = categoryMgr.getCategoryById("41101");
    category && console.log(category);

    category = categoryMgr.getCategoryByName("音乐电台");
    category && console.log(category);

    category = categoryMgr.getCategoryByName("野史趣闻");
    category && console.log(category);
}

//test();

module && (module.exports = CategoryMgr);